---

- name: install postgresql postgresql-contrib python3-pip libpq-dev
  become_user: root
  apt:
    name:
    - postgresql
    - postgresql-contrib
    - python3-pip
    - libpq-dev
    state: latest
  
- name: install pip psycopg2 patroni[etcd]
  become_user: root
  shell: |
    pip3 install --upgrade pip
    pip install psycopg2
    pip install patroni[etcd]
- name: make /data/patroni directory
  file:
    path: /data/patroni
    state: directory
    mode: '0700'
    owner: postgres
    group: postgres
- name: patroni service and patroni.yml configs
  block:
    - name: etc/systemd/system/patroni.service config
      template:
        src: etc/systemd/system/patroni.service.j2
        dest: /etc/systemd/system/patroni.service
    - name: etc/patroni.yml config
      template:
        src: etc/patroni.yml.j2
        dest: /etc/patroni.yml
  notify: actions
  
  

